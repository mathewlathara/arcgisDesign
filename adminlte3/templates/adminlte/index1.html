{% load static %}
<!DOCTYPE html>
<html lang="en">

<style>
  html,
  body,
  #viewDiv {
    padding: 0;
    margin: 0;
    height: 100%;
    width: 100%;
  }
</style>

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>WMS</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="{% static 'admin-lte/assets/img/favicon.png' %}" rel="icon">
  <link href="{% static 'admin-lte/assets/img/apple-touch-icon.png' %}" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{% static 'admin-lte/assets/vendor/aos/aos.css' %}" rel="stylesheet">
  <link href="{% static 'admin-lte/assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'admin-lte/assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'admin-lte/assets/vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
  <link href="{% static 'admin-lte/assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
  <link href="{% static 'admin-lte/assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">
  <link rel="stylesheet" href="https://js.arcgis.com/4.23/esri/themes/light/main.css">

  <!-- Template Main CSS File -->
  <link href="{% static 'admin-lte/assets/css/style.css' %}" rel="stylesheet">

  <!-- Plotly graphs -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
  <!-- ======= Header ======= -->
  <header id="header" class="d-flex align-items-center">
    <div class="container d-flex align-items-center justify-content-between">

      <h1 class="logo"><a href="index.html">DEX-Terity</a></h1>
      <!-- Uncomment below if you prefer to use an image logo -->
      <!-- <a href="index.html" class="logo"><img src="assets/img/logo.png" alt=""></a>-->

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="#hero">Home</a></li>
          <li><a class="nav-link scrollto" href="#features">Features</a></li>
          <li><a class="nav-link scrollto" href="#hotspot">Hotspots</a></li>
          <li><a class="nav-link scrollto " href="#statistics">Statistics</a></li>
          <li><a class="nav-link scrollto" href="#contact">Contact</a></li>
          <li><a class="nav-link scrollto" href="/logincontroller">Login</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="d-flex align-items-center">
    <div class="container" data-aos="zoom-out" data-aos-delay="100">
      <h1>Welcome to <span>Dex-Terity</span></h1>
      <h2>It needs a plan to preserve water</h2>
      <div class="d-flex" style="margin-left:80%;">
        <a href="#hotspot" class="btn-get-started scrollto">Explore</a>
      </div>
    </div>
  </section><!-- End Hero -->

  <main id="main">

    <!-- ======= Featured Services Section ======= -->
    <section id="features" class="featured-services">
      <div class="container" data-aos="fade-up">

        <div class="row">
          <div class="col-md-4 col-lg-4 d-flex align-items-stretch mb-5 mb-lg-0">
            <div class="icon-box" data-aos="fade-up" data-aos-delay="100">
              <h4 class="title"><a href="/logincontroller">UPLOAD</a></h4>
              <p class="description">Drop excel sheet with required features</p>
            </div>
          </div>

          <div class="col-md-4 col-lg-4 d-flex align-items-stretch mb-5 mb-lg-0">
            <div class="icon-box" data-aos="fade-up" data-aos-delay="200">
              <h4 class="title"><a href="/logincontroller">PREDICTION</a></h4>
              <p class="description">Predict phosphorus with 85% accuracy</p>
            </div>
          </div>

          <div class="col-md-4 col-lg-4 d-flex align-items-stretch mb-5 mb-lg-0">
            <div class="icon-box" data-aos="fade-up" data-aos-delay="300">
              <h4 class="title"><a href="/logincontroller">VISUALIZATION</a></h4>
              <p class="description">Filter features and visualize through graphs and maps</p>
            </div>
          </div>

        </div>

      </div>
    </section><!-- End Featured Services Section -->

    <!-- ======= Hotspot Section ======= -->
    <section id="hotspot" class="about section-bg">
      <div class="container" data-aos="fade-up">

        <div class="row">
          <div class="col-lg-4 pt-4 pt-lg-0 content d-flex flex-column justify-content-center" data-aos="fade-up"
            data-aos-delay="100">
            <h3>HOTSPOT STATIONS</h3>
            <p class="fst-italic">
              These are the stations where the amount of TotalPhosphorus and TotalNitrogen are noted higher than it
              should be(As per WHO and ODWQS)
            </p>
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
              ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
              fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt
              mollit anim id est laborum.
            </p>
          </div>
          <div class="col-lg-2">
            <label>Select a year</label>
            <span>
              <select class="custom-select yearFrom">

              </select>
            </span>
          </div>
          <div class="col-lg-6">
            <div id="viewDiv"></div>
          </div>
          <!-- <div class="col-md-10">
            <div id="viewDiv"></div>
          </div> -->
        </div>

      </div>
    </section><!-- End hotspot Section -->

    <!-- ======= statistics Section ======= -->
    <section id="statistics" class="services">
      <div class="container" data-aos="fade-up">

        <div class="row">
          <div class="col-lg-7" data-aos="fade-right" data-aos-delay="100">
            <!--            <img src="{% static 'admin-lte/assets/img/graphs.jpg' %}" class="img-fluid" alt="">-->
            <div id="plotP"></div>
          </div>

          <div class="col-lg-5 pt-4 pt-lg-0 content d-flex flex-column justify-content-center" data-aos="fade-up"
            data-aos-delay="100">
            <h3>STATISTICS</h3>
            <p class="fst-italic" style="font-size:14px;">
              These is the stastics section
            </p>
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
              ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
              fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt
              mollit anim id est laborum.
            </p>
          </div>
          <div class="row">
            <div class="col-lg-5 pt-4 pt-lg-0 content d-flex flex-column justify-content-center" data-aos="fade-up"
              data-aos-delay="100">
              <h3>STATISTICS</h3>
              <p class="fst-italic" style="font-size:14px;">
                These is the stastics section
              </p>
              <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
                ex
                ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
                fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
                deserunt
                mollit anim id est laborum.
              </p>
            </div>
            <div class="col-lg-7" data-aos="fade-right" data-aos-delay="100">
              <!--            <img src="{% static 'admin-lte/assets/img/graphs.jpg' %}" class="img-fluid" alt="">-->
              <div id="plotN"></div>
            </div>
          </div>
        </div>

      </div>
    </section><!-- End statistics Section -->

    <!-- ======= Testimonials Section ======= -->
    <section id="testimonials" class="testimonials">
      <div class="container" data-aos="fade-up">
        <div class="testimonials-slider swiper" data-aos="fade-up" data-aos-delay="100">
          <h3>Data sources</h3>
          <div>&nbsp;</div>
          <div class="swiper-wrapper">

            <div class="swiper-slide">
              <div class="testimonial-item">
                <img src="{% static 'admin-lte/assets/img/waterqtytrca.jpg' %}" style="width:350px;height:190px;"
                  class="testimonial-img" alt="">
                <h3>TRCA Water Quality Data</h3>
                <p>Water Quality data from monthly grab samples collected
                  at 90+ sites across more than nine watersheds in Toronto and Region
                  Conservation Authority’s (TRCA) jurisdiction. Samples are collected
                  monthly following the Provincial.. <a href="https://data.trca.ca/dataset?tags=Quality"
                    target="_blank">Read more...</a></p>
              </div>
            </div><!-- End testimonial item -->

            <div class="swiper-slide">
              <div class="testimonial-item">
                <img src="{% static 'admin-lte/assets/img/clocawaterquality.jpg' %}" style="width:350px;height:190px;"
                  class="testimonial-img" alt="">
                <h3>CLOCA Water Quality Data</h3>
                <p>Water Quality data from in-situ sampling taken from 36
                  sampling sites within the Central Lake Ontario Conservation
                  authority jurisdiction. Samples were collected monthly during the
                  summer months from 2017 – 2020 following the Provincial Water
                  Quality Monitoring Network Protocol. <a href="https://open-data.cloca.com/" target="_blank">Read
                    more...</a></p>
              </div>
            </div><!-- End testimonial item -->

            <div class="swiper-slide">
              <div class="testimonial-item">
                <img src="{% static 'admin-lte/assets/img/provincialwaterqualitynetwork.jpg' %}"
                  style="width:350px;height:190px;" class="testimonial-img" alt="">
                <h3>Provincial Water Quality Monitoring Network Data</h3>
                <p>Over 400 locations are currently monitored in
                  partnership with Ontario's Conservation Authorities, participating
                  municipalities and provincial parks. Partners collect water samples on
                  an approximately monthly basis and deliver them to the Ministry's
                  laboratory where they are analyzed for a suite of water quality
                  indicators. <a
                    href="https://data.ontario.ca/dataset/provincial-stream-water-quality-monitoring-network"
                    target="_blank">Read more...</a></p>
              </div>
            </div><!-- End testimonial item -->

            <div class="swiper-slide">
              <div class="testimonial-item">
                <img src="{% static 'admin-lte/assets/img/environmentalclimatedata.jpg' %}"
                  style="width:350px;height:190px;" class="testimonial-img" alt="">
                <h3>Environment and Climate Change Canada</h3>
                <p>Daily climate observations are derived from two sources
                  of data, both accessible as Historical Data from ECCC. The first are

                  Climate Station daily summaries recording total precipitation, mean,
                  min and max air temperatures. The second are hourly records that
                  typically produce more weather elements e.g. wind or snow on
                  ground. <a href="https://www.canada.ca/en/environment-climate-change.html" target="_blank">Read
                    more...</a></p>
              </div>
            </div><!-- End testimonial item -->

            <div class="swiper-slide">
              <div class="testimonial-item">
                <img src="{% static 'admin-lte/assets/img/ontariowaterbodyboundaries.jpg' %}"
                  style="width:350px;height:190px;" class="testimonial-img" alt="">
                <h3>Ontario Watershed Boundaries</h3>
                <p>The Ontario Watershed Boundaries (OWB) collection
                  represents the authoritative watershed boundaries for Ontario. The
                  data is based on a framework similar to the Atlas of Canada
                  Fundamental Drainage Areas and the United States Watershed
                  Boundary Dataset, however it adopts a more stringent scientific
                  approach to watershed delineation. <a
                    href="https://geohub.lio.gov.on.ca/maps/mnrf::ontario-watershed-boundaries-owb/explore?location=40.397199%2C-82.339420%2C2.74"
                    target="_blank">Read more...</a></p>
              </div>
            </div><!-- End testimonial item -->

          </div>

        </div>

      </div>
    </section><!-- End Testimonials Section -->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="row">

      <div class="col-lg-3 col-md-3 footer-contact">&nbsp;</div>

      <div class="col-lg-6 col-md-6 footer-links">
        <h4>&nbsp;</h4>
        <ul class="list-unstyled text-center">
          <li><a href="#">Home</a></li>
          <li><a href="#">About us</a></li>
          <li><a href="#">Hotspots</a></li>
          <li><a href="#">Statistics</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
      </div>

      <div class="col-lg-3 col-md-3 footer-links">&nbsp;</div>

    </div>
    <div class="container py-4">
      <div class="copyright col-lg-12 text-center">
        &copy; Copyright 2022
      </div>
    </div>

  </footer><!-- End Footer -->

  <input type="hidden" id="stationid">
  <input type="hidden" id="yearselectedinputhidden" value="{{yearselected}}">

  <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
  </div>

  <div class="modal fade" id="demographicsGraphModal">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Station ID: <span id="stationdisplaymodalbox"></span><span>,
              Year:{{yearselected}}</span></h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-lg-12">
              <span style="font-weight: bold;">Sampling site : </span><span id="totalsamplingsitelatitudeid"
                style="font-weight: bold;"></span><span style="font-weight: bold;">&#176;N</span><span
                id="totalsamplingsitelongitudeid" style="font-weight: bold; padding-left:5px; "></span><span
                style="font-weight: bold;">&#176;W</span><br>
              <span style="font-weight: bold;">Total sq.km : </span><span id="totalsqkmid"
                style="font-weight: bold;"></span><sup style="font-weight: bold;">2</sup><br>
              <span style="font-weight: bold;">Drainage basin : </span><span id="drainagebasinid"
                style="font-weight: bold;"></span><sup style="font-weight: bold;">2</sup><br>
              <span style="font-weight: bold;">Population : </span><span id="populationid"
                style="font-weight: bold;"></span>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-12" id="land-usechart"></div>
          </div>
          <div class="row">
            <div class="col-lg-12" id="soildatagraph"></div>
          </div>
          <div class="row">
            <div class="col-lg-12"><canvas id="meantemperaturedivision" style="width:100%;max-width:600px"></canvas>
            </div>
          </div>
          <div class="row">
            <div id="meanmaxrainfalldivision" class="col-lg-12"></div>
          </div>
        </div>
        <div class="modal-footer justify-content-between">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>

  <div id="preloader"></div>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="{% static 'admin-lte/assets/vendor/purecounter/purecounter.js' %}"></script>
  <script src="{% static 'admin-lte/assets/vendor/aos/aos.js' %}"></script>
  <script src="{% static 'admin-lte/assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'admin-lte/assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
  <script src="{% static 'admin-lte/assets/vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
  <script src="{% static 'admin-lte/assets/vendor/swiper/swiper-bundle.min.js' %}"></script>
  <script src="{% static 'admin-lte/assets/vendor/waypoints/noframework.waypoints.js' %}"></script>

  <!-- Template Main JS File -->
  <script src="{% static 'admin-lte/bootstrap/vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'admin-lte/assets/js/main.js' %}"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js "></script>
  <script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
  <script src="https://js.arcgis.com/4.23/"></script>
  <script src="{% static 'admin-lte/assets/js/arcgisjs/arcgisjs.js' %} "></script>
  <script>
    var jsonpointfile = {{ jsonvalue| safe }}
    $(document).ready(function () {
      loadmapvalues(1);

      var yearlist = ["2020", "2019", "2018", "2017", "2016"];
      yearselectbox = "<option value='' disabled selected>Select a year</option>";
      for (let j = 0; j < yearlist.length; j++) {
        if (yearlist[j] == "{{yearselected}}") {
          yearselectbox += "<option value=" + yearlist[j] + " selected>" + yearlist[j] + "</option>";
        } else {
          yearselectbox += "<option value=" + yearlist[j] + ">" + yearlist[j] + "</option>";
        }
      }

      $(".yearFrom").html(yearselectbox);

      $(document).on('change', '.yearFrom', function () {
        var yearselected = $(this).val();
        window.location.href = '?yearid=' + yearselected + "#hotspot";
      });
    });


    function loadmapvalues(filtertype) {
      require(["esri/config", "esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer", "esri/widgets/LayerList", "esri/Graphic", "esri/layers/GraphicsLayer", "esri/widgets/Legend", "esri/widgets/Expand"], function (esriConfig, Map, MapView, FeatureLayer, LayerList, Graphic, GraphicsLayer, Legend, Expand) {

        esriConfig.apiKey = "AAPKfb2205b571aa464b8280e4e744e3bde7rK2eQbS-fVv05DUtFVJUqBVoJjMIQGIMHK7rqQR-In8y-qSZSmNtobECX3jGCzGG";

        const template = {
          // autocasts as new PopupTemplate()
          title: "Demographics",
          content: [
            {
              // It is also possible to set the fieldInfos outside of the content
              // directly in the popupTemplate. If no fieldInfos is specifically set
              // in the content, it defaults to whatever may be set within the popupTemplate.
              type: "fields",
              fieldInfos: [
                {
                  fieldName: "Landuse_Fu",
                  label: "Land type"
                },
                {
                  fieldName: "layer",
                  label: "Layer",
                  format: {
                    digitSeparator: true,
                    places: 0
                  }
                },
                {
                  fieldName: "VegType",
                  label: "Vegitation type",
                  format: {
                    digitSeparator: true,
                    places: 0
                  }
                },
                {
                  fieldName: "Topographi",
                  label: "Topography",
                  format: {
                    digitSeparator: true,
                    places: 0
                  }
                }
              ]
            }
          ]
        };

        const TRCALanduseRenderer = {
          type: "simple", // autocasts as new SimpleRenderer()
          symbol: {
            type: "simple-fill", // autocasts as new SimpleFillSymbol()
            color: "rgb(213, 210, 210)",
            outline: {
              color: "rgb(0, 0, 0)",
              width: 0.01
            }
          }
        };

        const featureLayer = new FeatureLayer({
          url: "https://services.arcgis.com/t0XyVE44waBIPBFr/arcgis/rest/services/merged_land_cover/FeatureServer/0",
          // popupTemplate: template,
          renderer: TRCALanduseRenderer,
          title: "TRCA Landuse base map"
        });

        /*-------------------------------- TRCA base land ----------------------------------------------------------------*/

        function TRCACustomRegion(feature) {
          var stationid = feature.graphic.attributes.UniqueID;
          const div = document.createElement("div");
          console.log("I am here ------>" + JSON.stringify(stationid));
          $.ajax({
            type: 'GET',
            url: 'http://localhost:8000/arcgisMapParametersDurhamRegion/?stationid=' + stationid + "&dateselected=" + "{{yearselected}}",
            success: function (data) {
              console.log(JSON.stringify(data));
              div.innerHTML = "<p><u><b>Station ID: " + data.stationid + "</b></u></p><ul><li>Avg chloride: " + data.avgchloride + "</li><li>Avg population: " + data.avgpopulation + "</li><li>Avg phosphorus: " + data.avgphosphorus + "</li><li>Avg nitrogen: " + data.avgnitrogen + "</li></ul>";
            },
            error: function (error) {
              alert("error");
            }
          });
          return div;
        }

        const TRCABASEtemplate = {
          // autocasts as new PopupTemplate()
          title: "TRCA region",
          outFields: ["UniqueID"],
          content: TRCACustomRegion
          // content: [
          //     {
          //         // It is also possible to set the fieldInfos outside of the content
          //         // directly in the popupTemplate. If no fieldInfos is specifically set
          //         // in the content, it defaults to whatever may be set within the popupTemplate.
          //         type: "fields",
          //         fieldInfos: [
          //             {
          //                 fieldName: "layer",
          //                 label: "Layer",
          //                 format: {
          //                     digitSeparator: true,
          //                     places: 0
          //                 }
          //             },
          //         ]
          //     }
          // ]
        };

        const TRCARenderer = {
          type: "simple", // autocasts as new SimpleRenderer()
          symbol: {
            type: "simple-fill", // autocasts as new SimpleFillSymbol()
            color: "rgb(79, 102, 68)",
            outline: {
              color: "rgb(255, 255, 255)",
              width: 0.5
            }
          }
        };

        const TRCABaseLayer = new FeatureLayer({
          url: "https://services6.arcgis.com/1c4OxPOWDbePZZBO/arcgis/rest/services/newtrcaregion/FeatureServer/0",
          popupTemplate: TRCABASEtemplate,
          renderer: TRCARenderer,
          opacity: 0.5,
          title: "TRCA region"
        });

        /* ---------------------------------- Durham region -------------------------------------------------*/

        const durhamAdditionalDetials = {
          title: "Show graphs",
          id: "detail-this",
          image: "static/admin-lte/dist/img/adddetailsimg.png" // this section is for adding additional details button
        };

        function durhamregCustomRegion(feature) {
          var stationid = feature.graphic.attributes.UniqueID;
          const div = document.createElement("div");
          console.log("I am here ------>" + JSON.stringify(stationid));
          $.ajax({
            type: 'GET',
            url: 'http://localhost:8000/arcgisMapParametersDurhamRegion/?stationid=' + stationid + "&dateselected=" + "{{yearselected}}",
            success: function (data) {
              console.log(JSON.stringify(data));
              $("#stationid").val(stationid);
              div.innerHTML = "<p><u><b>Station ID: " + data.stationid + "</b></u></p><ul><li>Avg chloride: " + data.avgchloride + "</li><li>Avg population: " + data.avgpopulation + "</li><li>Avg phosphorus: " + data.avgphosphorus + "</li><li>Avg nitrogen: " + data.avgnitrogen + "</li></ul>";
            },
            error: function (error) {
              alert("error");
            }
          });
          return div;
        }

        const durhamtemplate = {
          // autocasts as new PopupTemplate()
          title: "Durham region, Year:{{yearselected}}",
          outFields: ["UniqueID"],
          content: durhamregCustomRegion,
          actions: [durhamAdditionalDetials]
          // content: [
          //     {
          //         // It is also possible to set the fieldInfos outside of the content
          //         // directly in the popupTemplate. If no fieldInfos is specifically set
          //         // in the content, it defaults to whatever may be set within the popupTemplate.
          //         type: "fields",
          //         fieldInfos: [
          //             {
          //                 fieldName: "layer",
          //                 label: "Layer",
          //                 format: {
          //                     digitSeparator: true,
          //                     places: 0
          //                 }
          //             },
          //         ]
          //     }
          // ]
        };

        const DurhamRenderer = {
          type: "simple", // autocasts as new SimpleRenderer()
          symbol: {
            type: "simple-fill", // autocasts as new SimpleFillSymbol()
            color: "rgb(209, 213, 187)",
            outline: {
              color: "rgb(0, 0, 0)",
              width: 1
            }
          }
        };

        const DurhamLayer = new FeatureLayer({
          url: "https://services6.arcgis.com/1c4OxPOWDbePZZBO/arcgis/rest/services/durham_edited/FeatureServer/0",
          popupTemplate: durhamtemplate,
          renderer: DurhamRenderer,
          opacity: 0.3,
          title: "Durham region, Year:{{yearselected}}",
        });

        function createFillSymbol(value, color) {
          return {
            "value": value,
            "symbol": {
              "color": color,
              "type": "simple-fill",
              "style": "solid",
              "outline": {
                color: "rgb(0, 0, 0)",
                width: 0.1
              }
            },
            "label": value
          };
        }

        const SpacesRenderer2017 = {
          type: "unique-value",
          field: "Landuse_Fu",
          uniqueValueInfos: [
            createFillSymbol("Agricultural", "#3282bd"),
            createFillSymbol("Institutional", "#EBF90D"),
            createFillSymbol("Roads", "#FB1102"),
            createFillSymbol("Lacustrine", "#05FBDC"),
            createFillSymbol("Airport", "#09F4F5"),
            createFillSymbol("Medium Density Residential", "#E5550E"),
            createFillSymbol("Forest", "#08B22B"),
            createFillSymbol("Commercial", "#766bb3"),
            createFillSymbol("Industrial", "#766bb3"),
            createFillSymbol("Meadow", "#48FB12"),
            createFillSymbol("Estate Residential", "#0752F6"),
            createFillSymbol("Mixed Commercial Entertainment", "#CB07F6")
          ],
          outline: {
            color: "rgb(0, 0, 2)",
            width: 0.1
          }
        };

        const SpaceRenderOtherThan2017 = {
          type: "unique-value",
          field: "HABITAT",
          uniqueValueInfos: [
            createFillSymbol("forest", "#08B22B"),
            createFillSymbol("wetland", "#EBF90D"),
            createFillSymbol("meadow", "#48FB12"),
            createFillSymbol("succ", "#766bb3")
          ],
          outline: {
            color: "rgb(0, 0, 2)",
            width: 0.1
          }
        };

        // Create the layer and set the renderer
        var yearselectedinputhidden = $("#yearselectedinputhidden").val();
        var openspacerendererselected = null
        // if (yearselectedinputhidden == "2017") {
        openspacerendererselected = SpacesRenderer2017;
        // } else {
        // openspacerendererselected = SpaceRenderOtherThan2017;
        // }
        const induvidualLayers = new FeatureLayer({
          url: "{{regiondemographicrenderurl|safe}}",
          renderer: openspacerendererselected,
          // popupTemplate: template,
          // opacity: 0.9,
          title: "TRCA Landuse {{yearselected}} demographics"
        });

        const ELCTRCARenderer = {
          type: "simple", // autocasts as new SimpleRenderer()
          symbol: {
            type: "simple-fill", // autocasts as new SimpleFillSymbol()
            color: "rgb(189, 184, 135)",
            outline: {
              color: "rgb(0, 0, 0)",
              width: 0.1
            }
          }
        };

        const ELCTRCA = new FeatureLayer({
          url: "https://services.arcgis.com/t0XyVE44waBIPBFr/arcgis/rest/services/elc_trca_shp/FeatureServer/0",
          // popupTemplate: template,
          renderer: ELCTRCARenderer,
          title: "ELC TRCA"
        });

        const CLOCALandcoverRender = {
          type: "simple", // autocasts as new SimpleRenderer()
          symbol: {
            type: "simple-fill", // autocasts as new SimpleFillSymbol()
            color: "rgb(189, 135, 158)",
            outline: {
              color: "rgb(0, 0, 0)",
              width: 0.1
            }
          }
        };

        const CLOCALandcoverBase = new FeatureLayer({
          url: "https://services.arcgis.com/t0XyVE44waBIPBFr/arcgis/rest/services/cloca_land_covershp/FeatureServer/0",
          // popupTemplate: template,
          renderer: CLOCALandcoverRender,
          title: "CLOCA Land cover"
        });

        const ECOLOGLANDClassificRender = {
          type: "simple", // autocasts as new SimpleRenderer()
          symbol: {
            type: "simple-fill", // autocasts as new SimpleFillSymbol()
            color: "rgb(218, 210, 220)",
            outline: {
              color: "rgb(0, 0, 0)",
              width: 0.1
            }
          }
        };

        const ECOLOGLANDClassificBase = new FeatureLayer({
          url: "https://services.arcgis.com/t0XyVE44waBIPBFr/arcgis/rest/services/cloca_land_covershp/FeatureServer/0",
          // popupTemplate: template,
          renderer: ECOLOGLANDClassificRender,
          title: "Ecological land classification"
        });

        const map = new Map({
          basemap: "gray-vector",
          layers: [featureLayer, induvidualLayers, ELCTRCA, CLOCALandcoverBase, ECOLOGLANDClassificBase, DurhamLayer]
        });

        const graphicsLayer = new GraphicsLayer({
          title: "Station points"
        });
        map.add(graphicsLayer);

        for (var i = 0; i < jsonpointfile.length; i++) {
          console.log(jsonpointfile[i].stationiconlink);
          const simpleMarkerSymbol = {
            // type: "simple-marker",
            // color: [226, 119, 40],  // Orange
            // outline: {
            //     color: [255, 255, 255], // White
            //     width: 1
            // }
            type: "picture-marker",
            url: "static/admin-lte/dist/img/" + jsonpointfile[i].stationiconlink,
            width: "25px",
            height: "60px"
          };
          // console.log(jsonpointfile[i])
          const point = { //Create a point
            type: "point",
            longitude: jsonpointfile[i].longitude,
            latitude: jsonpointfile[i].latitude
          };

          const popupTemplate = {
            title: "{Name}",
            content: "{Description}",
          }

          const attributes = {
            Name: "Station name: " + jsonpointfile[i].station,
          }

          const pointGraphic = new Graphic({
            geometry: point,
            symbol: simpleMarkerSymbol,
            attributes: attributes,
            popupTemplate: popupTemplate
          });
          graphicsLayer.add(pointGraphic);
        }

        const view = new MapView({
          container: "viewDiv",
          map: map,
          center: [-78.8911306275, 43.9299554612],
          zoom: 9
        });

        function piechart(xvalues, yvalues, colorneeded, displaytext) {
          var xValues = xvalues;
          var yValues = yvalues;
          var barColors = colorneeded;

          new Chart("myChart", {
            type: "pie",
            data: {
              labels: xValues,
              datasets: [{
                backgroundColor: barColors,
                data: yValues
              }]
            },
            options: {
              title: {
                display: true,
                text: displaytext
              }
            }
          });
        }

        view.popup.on("trigger-action", (event) => {
          // Execute the measureThis() function if the measure-this action is clicked
          if (event.action.id === "detail-this") {
            let stationid = $("#stationid").val();
            $.ajax({
              type: 'GET',
              url: 'http://localhost:8000/arcgisMapSoilDetailsAPI/?stationid=' + stationid + "&dateselected=" + "{{yearselected}}",
              success: function (data) {
                if (data.status === "success") {
                  $("#stationdisplaymodalbox").html(stationid);
                  $('#demographicsGraphModal').modal('show');
                  // piechart(["CSS/with clay", "CSS/All together", "CSS/with sand", "CSS/with silt", "CSS/unknown"], [data.totalTCLAYwtd, data.totalTOTHERwtd, data.totalTSANDwtd, data.totalTSILTwtd, data.totalTUNKNOWNwtd], [ "#F2900B", "#F2D20B", "#DDFE04", "#A9F20A", "#D7DCCC"], "Soil/Sand data")
                  // var trace1 = {
                  //     x: [0, 1, 2, 3, 4, 5],
                  //     y: [1.5, 1, 1.3, 0.7, 0.8, 0.9],
                  //     type: 'scatter'
                  // };

                  // var trace2 = {
                  //     x: [0, 1, 2, 3, 4, 5],
                  //     y: [1, 0.5, 0.7, -1.2, 0.3, 0.4],
                  //     type: 'bar'
                  // };
                  $("#totalsamplingsitelatitudeid").html(data.latitude);
                  $("#totalsamplingsitelongitudeid").html(data.longitude);
                  $("#totalsqkmid").html(data.totalareasqkm[0] + " km");
                  $("#drainagebasinid").html(data.totaldrainagebasinsqkm + " km");
                  $("#populationid").html(data.totalpopulation);
                  var listarrayvalue = [];
                  var rainfallbargraph = [];
                  for (var i = 0; i < data.linegraphreturnlist.length; i++) {
                    console.log(data.linegraphreturnlist[i]);
                    listarrayvalue.push(data.linegraphreturnlist[i]);
                    rainfallbargraph.push(data.bargraphRainfall[i]);
                  }

                  var xValues = [56, 28, 7, 3, 1];

                  new Chart("meantemperaturedivision", {
                    type: "line",
                    data: {
                      labels: xValues,
                      datasets: data.linegraphreturnlist
                    },
                    options: {
                      scales: {
                        yAxes: [{
                          scaleLabel: {
                            display: true,
                            labelString: 'Integrted mean temperature(\xB0C)'
                          }
                        }],
                        xAxes: [{
                          scaleLabel: {
                            display: true,
                            labelString: 'Days preceding collection'
                          }
                        }]
                      },
                      legend: { display: false }
                    }
                  });

                  var layout = { barmode: 'group', xaxis: { title: 'Days preceding collection' }, yaxis: { title: 'Integrated precipitation' }, bargap: 0.01 };

                  Plotly.newPlot('meanmaxrainfalldivision', rainfallbargraph, layout);

                  var areawiseuseagevalues = [{
                    values: [data.totalagricultural[0], data.totalanthropogenic[0], data.totalnatural[0]],
                    labels: ['Agricultural', 'Urban', 'Natural'],
                    domain: { column: 0 },
                    name: 'GHG Emissions',
                    hoverinfo: 'label+percent+name',
                    hole: .4,
                    marker: {
                      colors: ['#3282bd', '#E5550E', '#08B22B'],
                      line: {
                        color: 'white',
                        width: 1
                      }
                    },
                    type: 'pie'
                  }];
                  var areawiseusagelayout = {
                    title: "Land usage"
                  };
                  Plotly.newPlot("land-usechart", areawiseuseagevalues, areawiseusagelayout);

                  var claylayer = {
                    x: [data.totalTCLAYwtd[0]],
                    y: [''],
                    width: [0.8],
                    name: 'Clay',
                    orientation: 'h',
                    marker: {
                      color: '#987D48',
                      width: 0.01
                    },
                    type: 'bar'
                  };

                  var siltlayer = {
                    x: [data.totalTSILTwtd[0]],
                    y: [''],
                    width: [0.8],
                    name: 'Silt',
                    orientation: 'h',
                    marker: {
                      color: '#BE9D3C',
                      width: 0.01
                    },
                    type: 'bar'
                  };

                  var sandlayer = {
                    x: [data.totalTSANDwtd[0]],
                    y: [''],
                    width: [0.8],
                    name: 'Sand',
                    orientation: 'h',
                    marker: {
                      color: '#EABA56',
                      width: 0.01
                    },
                    type: 'bar'
                  };

                  var otherlayer = {
                    x: [data.totalTOTHERwtd[0]],
                    y: [''],
                    width: [0.8],
                    name: 'Other',
                    orientation: 'h',
                    marker: {
                      color: '#E8CB91',
                      width: 0.01
                    },
                    type: 'bar'
                  };

                  var unknownlayer = {
                    x: [data.totalTUNKNOWNwtd[0]],
                    y: [''],
                    width: [0.8],
                    name: 'Unknown',
                    orientation: 'h',
                    marker: {
                      color: '#853A35',
                      width: 0.01
                    },
                    type: 'bar'
                  };

                  var soilwisedata = [claylayer, siltlayer, sandlayer, otherlayer, unknownlayer];

                  var soilwiselayout = {
                    barmode: 'stack', title: "Soil layer data", xaxis: {
                      autorange: true,
                      showgrid: false,
                      zeroline: false,
                      showline: false,
                      autotick: true,
                      ticks: '',
                      showticklabels: false
                    },
                    yaxis: {
                      autorange: true,
                      showgrid: false,
                      zeroline: false,
                      showline: false,
                      autotick: true,
                      ticks: '',
                      showticklabels: false
                    }
                  };

                  Plotly.newPlot('soildatagraph', soilwisedata, soilwiselayout);

                  // var data = [trace1, trace2];

                } else {
                  alert("Proper data not present");
                }
              },
              error: function (error) {
                alert("error");
              }
            });
            // alert(stationid);
          }
        });

        const legend = new Legend({
          view: view,
          style: "card"
        });

        const legendbgExpand = new Expand({
          view: view,
          content: legend
        });

        view.ui.add(legendbgExpand, "bottom-left");

        view.when(() => {
          const layerList = new LayerList({
            view: view
          });

          const layerListdbgExpand = new Expand({
            view: view,
            content: layerList
          });

          // Add widget to the top right corner of the view
          view.ui.add(layerListdbgExpand, "top-right");
        });


        function openNav() {
          document.getElementById("mySidenav").style.width = "400px";
        }

        view.popup.on("trigger-action", (event) => {
          // Execute the measureThis() function if the measure-this action is clicked
          if (event.action.id === "detail-this") {
            openNav();
          }
        });

      });
    }
  </script>
</body>

</html>