{% extends 'adminlte/new_dashboard_base.html' %}
{% load static %}
{% block extra_cssheader %}
<link rel="stylesheet" href="https://js.arcgis.com/4.23/esri/themes/light/main.css">
<style>
    html,
    body,
    #viewDiv {
        padding: 0;
        margin: 0;
        height: 550px;
        width: 100%;
    }

    .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1;
        top: 0;
        right: 0;
        background-color: #111;
        overflow-x: hidden;
        transition: 0.5s;
        padding-top: 60px;
    }

    .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.3s;
    }

    .sidenav a:hover {
        color: #f1f1f1;
    }

    .sidenav .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
    }
    .box {
			position: relative;
			margin-left: 20px;
		}
		.box:before{
			position: absolute;
			left: -20px;
			content: "";
			height:20px;
			width:20px;
			margin-bottom:15px;
			border:1px solid black;
		}
		.box.agricultural:before{
			background-color:#3282bd;
		}
		.box.anthropogenic:before{
			background-color:#A52A2A;
		}
		.box.natural:before{
			background-color:#08B22B;
		}
		.box.water:before{
			background-color:#00FFFF;
		}
		.box.urban:before{
			background-color:#EBF90D;
		}
		.box.rural:before{
			background-color:#0752F6;
		}
		.box.other:before{
			background-color:#FB1102;
		}
        .carousel-control-next,
        .carousel-control-prev /*, .carousel-indicators */ {
            filter: invert(100%);
        }
</style>
{% endblock %}

{% block content %}

<div class="container-fluid">

    <div class="row">
        <div class="col-lg-2">
            <label>Select a year</label>
            <span>
                <select class="custom-select yearFrom">

                </select>
            </span>
        </div>
    </div>
    <div>&nbsp;</div>
    <div class="row">
        <div class="col-lg-12">
            <div id="viewDiv"></div>
        </div>
    </div>


</div>

<input type="hidden" id="stationid">
<input type="hidden" id="yearselectedinputhidden" value="{{yearselected}}">

<div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
</div>

<div class="modal fade" id="demographicsGraphModal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Station ID: <span id="stationdisplaymodalbox"></span><span>,
                        Year:{{yearselected}}</span></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <span style="font-weight: bold;">Sampling site : </span><span id="totalsamplingsitelatitudeid"
                            style="font-weight: bold;"></span><span style="font-weight: bold;">&#176;N</span><span
                            id="totalsamplingsitelongitudeid" style="font-weight: bold; padding-left:5px; "></span><span
                            style="font-weight: bold;">&#176;W</span><br>
                        <span style="font-weight: bold;">Total sq.km : </span><span id="totalsqkmid"
                            style="font-weight: bold;"></span><sup style="font-weight: bold;">2</sup><br>
                        <span style="font-weight: bold;">Drainage basin : </span><span id="drainagebasinid"
                            style="font-weight: bold;"></span><sup style="font-weight: bold;">2</sup><br>
                        <span style="font-weight: bold;">Population : </span><span id="populationid"
                            style="font-weight: bold;"></span>
                    </div>
                </div>
                <div class="row" id="notdatafoundmodalrow">
                    <div class="col-lg-12">
                        <p style="color:red">No data available for this station to plot charts.</p>
                    </div>
                </div>
                <div class="row graphclass">
                    <div class="col-lg-12" id="land-usechart"></div>
                </div>
                <div class="row graphclass">
                    <div class="col-lg-12" id="soildatagraph"></div>
                </div>
                <div class="row graphclass">
                    <div class="col-lg-12"><canvas id="meantemperaturedivision"
                            style="width:100%;max-width:600px"></canvas></div>
                </div>
                <div class="row graphclass">
                    <div id="meanmaxrainfalldivision" class="col-lg-12"></div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>


<div class="container mt-4 mb-5">
    <div class="row">
        <div class="col-lg-4">
            <h5 class="text-primary">Legend</h5>
            <div class='box agricultural'>Agricultural Land</div>
            <div class='box anthropogenic'>Anthropogenic Land</div>
            <div class='box natural'>Natural Land</div>
            <div class='box water'>Surface Water Land</div>
            <div class='box urban'>Urban Land</div>
            <div class='box rural'>Rural Land</div>
            <div class='box other'>Other</div>
        </div>
        <div class="col-lg-4">
            <div><img class="img-fluid" src="{% static 'admin-lte/dist/img/hotspot.png' %}"> Hotspot</div>
            <div><img class="img-fluid" src="{% static 'admin-lte/dist/img/normalregion.png' %}"> Normal</div>
        </div>
    </div>
    <div class="row mt-5">
        <h1 class="text-primary font-weight-bold">
            Data Platform
        </h1>
    </div>
    <div class="row">
        <h2 class="text-primary font-weight-normal">
            Map Tool
        </h2>
        <p class="text-secondary font-weight-light">
            Learn about our pilot region using data from the Central Lake Ontario Conservation Area (CLOCA)
            and the Toronto and Region Conservation Authority (TRCA).
        </p>
        <ol class="font-weight-light">
            <li>Select year for navigation</li>
            <li>Explore layers on the map</li>
            <li>Get information about specific stations</li>
        </ol>
    </div>
    <div class="row mt-3">
        <h2 class="text-primary font-weight-normal">
            Model Information<br>
        </h2>
        <p class="text-secondary font-weight-light"> A machine learning model takes historical data 
            as input to be trained, i.e. to find the hidden pattern in the data that relates 
            inputs (features) to output (Target variable, e.g, Total Phosphorus load in water 
            ). Train dataset is also called seen data as the data has been seen by the model 
            while training and it tries to adjust the weights of all the input variables that 
            help in predicting the target variable. Therefore the trained ML-based model can 
            predict the target variables for unseen input data (i.e. Test or Future data).
        </p>
        <p class="text-secondary font-weight-light">
            Random forest is a Supervised Machine Learning Algorithm that is 
            used widely in Classification and Regression problems. It builds decision trees on 
            different samples and takes their majority vote for classification and average in 
            case of regression. 
        </p>
        <p class="text-secondary font-weight-light">
            Here we have a regression problem as the target parameters to 
            predict Total Phosphorus and Total Nitrogen are continuous values, hence the 
            Random Forest Regressor model fits best to make the accurate prediction.
        </p>
        <p class="text-secondary font-weight-light">
            R2 is a measure of the goodness of fit of a model. In regression, the 
            R2 coefficient of determination is a statistical measure of how well the 
            regression predictions approximate the real data points or how well the model 
            has performed in predicting the desired results.            
        </p>
    </div>
    <div class="row ml-5 mr-5">
        <table class="table table-bordered">
            <thead>
              <tr>
                <th scope="col">Target Indicator</th>
                <th scope="col">Model Performance</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Total Phosphorus (mg/L)</th>
                <td>85%</td>
              </tr>
              <tr>
                <th scope="row">Total Nitrogen (mg/L)</th>
                <td>83%</td>
              </tr>
            </tbody>
          </table>
    </div>
    
    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
		<div class="row text-center mt-5">
			<div class="col col-lg-10 offset-lg-1">
				<h1 class="gy-5 text-primary m-5">Data Sources</h1>
				<div class="carousel-inner">
					<div class="carousel-item active">
						<h6>CLCC Water Quality Data 1</h6>
						<p><img class="img-fluid"
								src="{% static 'admin-lte/assets/img/new_d/Screen_Shot_2022-06-15_at_1027.png' %}"></p>
						<p class="m-3">
							<button class="btn btn-primary rounded-pill" type="button">
								<h6 class="mx-3">Read more</h6>
							</button>
						</p>
					</div>
					<div class="carousel-item">
						<h6>CLCC Water Quality Data 2</h6>
						<p><img class="img-fluid"
								src="{% static 'admin-lte/assets/img/new_d/Screen_Shot_2022-06-15_at_1027_b.png' %}">
						</p>
						<p class="m-3">
							<button class="btn btn-primary rounded-pill" type="button">
								<h6 class="mx-3">Read more</h6>
							</button>
						</p>
					</div>
					<div class="carousel-item">
						<h6>CLCC Water Quality Data 3</h6>
						<p><img class="img-fluid"
								src="{% static 'admin-lte/assets/img/new_d/Screen_Shot_2022-06-15_at_1027_ca.png' %}">
						</p>
						<p class="m-3">
							<button class="btn btn-primary rounded-pill" type="button">
								<h6 class="mx-3">Read more</h6>
							</button>
						</p>
					</div>
				</div>
				<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span>
					<span class="sr-only">Previous</span>
				</a>
				<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</a>
			</div>
		</div>
	</div>
</div>

{% endblock %}

{% block javascriptedit %}
<script src="{% static 'admin-lte/bootstrap/vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'admin-lte/bootstrap/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

<!-- Core plugin JavaScript-->
<script src="{% static 'admin-lte/bootstrap/vendor/jquery-easing/jquery.easing.min.js' %}"></script>

<!-- Custom scripts for all pages-->
<script src="{% static 'admin-lte/bootstrap/js/sb-admin-2.min.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js "></script>
<script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
<script src="https://js.arcgis.com/4.23/"></script>
<script src="{% static 'admin-lte/assets/js/arcgisjs/Fullarcgis.js' %} "></script>
<script>
    var jsonpointfile = {{ jsonvalue| safe }};
    $(document).ready(function () {
        var regionrenderurl = "{{regiondemographicrenderurl|safe}}";
        var loadingurl = "199.241.160.97";
        loadmapvalues(1, jsonpointfile, loadingurl, regionrenderurl, "{{yearselected}}", "{{ trcadurhammapcombinedurl| safe }}");

        var yearlist = ["2020", "2019", "2018", "2017", "2016", "2015", "2014", "2013", "2012", "2011", "2010", "2009", "2008", "2007", "2006", "2005", "2004", "2003", "2002"];
        yearselectbox = "<option value='' disabled selected>Select a year</option>";
        for (let j = 0; j < yearlist.length; j++) {
            if (yearlist[j] == "{{yearselected}}") {
                yearselectbox += "<option value=" + yearlist[j] + " selected>" + yearlist[j] + "</option>";
            } else {
                yearselectbox += "<option value=" + yearlist[j] + ">" + yearlist[j] + "</option>";
            }
        }

        $(".yearFrom").html(yearselectbox);

        $(document).on('change', '.yearFrom', function () {
            var yearselected = $(this).val();
            window.location.href = '/describe/' + yearselected;
        });

    });
</script>
{% endblock %}